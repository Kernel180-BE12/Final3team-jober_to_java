- name: Restart application on EC2
  uses: appleboy/ssh-action@v0.1.6
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ubuntu
    key: ${{ secrets.EC2_SSH_KEY }}
    script: |
      chmod +x /home/ubuntu/scripts/*.sh

      # ===== 환경변수 세팅 (앱이 이 값들을 사용) =====
      export DB_URL="${{ secrets.DB_URL }}"
      export DB_USER="${{ secrets.DB_USER }}"
      export DB_PASS="${{ secrets.DB_PASS }}"
      export JWT_SECRET="${{ secrets.JWT_SECRET }}"
      export OTP_PEPPER="${{ secrets.OTP_PEPPER }}"
      export REFRESH_PEPPER="${{ secrets.REFRESH_PEPPER }}"
      export VERIFY_BASE_URL="${{ secrets.VERIFY_BASE_URL }}"
      export AI_BASE_URL="${{ secrets.AI_BASE_URL }}"

      # 보안/쿠키/CORS/CSRF (추가)
      export CORS_ALLOWED_ORIGINS="${{ secrets.CORS_ALLOWED_ORIGINS }}"
      export APP_COOKIE_SAMESITE="${{ secrets.APP_COOKIE_SAMESITE }}"   # Lax/None/Strict
      export APP_COOKIE_SECURE="${{ secrets.APP_COOKIE_SECURE }}"       # "true"/"false"
      export APP_COOKIE_MAX_AGE="${{ secrets.APP_COOKIE_MAX_AGE }}"     # 1209600 등
      export APP_COOKIE_PATH="${{ secrets.APP_COOKIE_PATH }}"           # /api/auth 권장
      export CSRF_ENABLED="${{ secrets.CSRF_ENABLED }}"                 # "true"/"false"

      # ===== 앱 재시작 =====
      /home/ubuntu/scripts/stop.sh
      sleep 3
      /home/ubuntu/scripts/start.sh
